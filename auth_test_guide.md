# 注册登录与路由权限测试指南

本文档提供了测试股票量化交易系统中注册登录功能和路由权限验证的详细指南。

## 测试工具列表

以下是已创建的测试工具及其用途：

1. **test_complete_auth_flow.py** - 完整的认证流程测试脚本
2. **view_users_table.py** - 查看数据库中用户表数据的脚本
3. **test_register_login.py** - 自动化测试注册登录API的脚本
4. **clear_local_storage.html** - 清除浏览器本地存储的网页工具

## 测试前准备

在进行测试前，请确保以下服务已启动：

1. **后端服务**：
   ```bash
   python src/models/server.py
   ```

2. **前端服务**：
   ```bash
   npm run serve
   ```

## 使用步骤

### 1. 完整认证流程测试

运行`test_complete_auth_flow.py`脚本可以自动测试注册、登录功能，并打开浏览器进行手动测试：

```bash
python test_complete_auth_flow.py
```

此脚本会：
- 检查前后端服务状态
- 创建一个带时间戳的测试用户
- 测试用户注册功能
- 测试用户登录功能
- 自动打开清除本地存储页面
- 自动打开前端登录页面

### 2. 查看用户数据

运行`view_users_table.py`脚本可以查看数据库中所有用户的信息（不包含密码等敏感信息）：

```bash
python view_users_table.py
```

### 3. 自动化API测试

运行`test_register_login.py`脚本可以自动化测试多种注册登录场景：

```bash
python test_register_login.py
```

此脚本会测试：
- 新用户注册
- 正确密码登录
- 错误密码登录
- 重复用户名注册

### 4. 清除浏览器本地存储

在测试不同用户登录前，建议先清除浏览器本地存储：

1. 打开`clear_local_storage.html`文件（可以直接双击或通过脚本自动打开）
2. 点击"清除localStorage"按钮
3. 确认看到"localStorage已清除"的提示

## 手动测试路由权限

完成上述自动化测试后，可以进行手动测试验证路由权限：

1. **清除本地存储**：访问`clear_local_storage.html`并清除
2. **访问登录页**：打开`http://localhost:8082/login`
3. **登录测试**：使用测试用户账户登录
   - 正确的用户名和密码应该能够成功登录
   - 错误的用户名或密码应该被拒绝
4. **访问受限页面**：登录成功后，尝试访问需要登录权限的页面
   - 验证是否能够正常访问
   - 验证页面内容是否根据用户角色正确显示
5. **退出登录测试**：退出登录后，验证是否无法访问受限页面

## 常见问题排查

如果测试过程中遇到问题，可以尝试以下排查步骤：

1. **前后端服务连接问题**：
   - 确认后端服务运行在`http://localhost:5000`
   - 确认前端服务运行在`http://localhost:8082`
   - 检查防火墙设置

2. **数据库连接问题**：
   - 确认PostgreSQL数据库服务正在运行
   - 检查数据库连接参数是否正确（host、port、database、user、password）

3. **路由权限问题**：
   - 确认`router/index.js`中的权限验证代码已正确配置
   - 检查浏览器控制台是否有错误信息
   - 验证localStorage中是否正确存储了token和用户信息

## 测试结果分析

- 注册成功：用户信息应显示在`view_users_table.py`的输出中
- 登录成功：前端应能正确跳转并显示用户信息
- 路由权限正常：未登录用户无法访问受限页面，登录用户可根据角色访问对应页面

## 注意事项

1. 测试环境使用的是开发服务器，请勿在生产环境中使用这些测试脚本
2. 测试用户账户为临时账户，测试完成后可根据需要删除
3. 请妥善保管数据库连接信息，不要泄露敏感信息